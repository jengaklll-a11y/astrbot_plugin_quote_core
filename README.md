# 💬 AstrBot 语录核心插件 (Quote Core)

> 支持 AI 智能挖掘 | 性能优化版

一个功能强大的群聊语录插件。支持手动收录、随机抽卡、生成精美语录图片，并集成了 LLM (AI) 自动挖掘群聊“神回复”的功能。

## ✨ 特性

- **📸 语录收录**：回复消息即可一键收录，支持图片和文本。
- **🃏 语录抽卡**：随机发送一张语录卡片，支持按人名、按数量批量获取。
- **🤖 AI 智能挖掘**：
  - **深度分析**：AI 自动阅读历史消息，识别“神回复”与“抽象发言”。
  - **鲁棒解析**：内置智能 JSON 修复引擎，兼容各种“不听话”的大模型返回格式（支持单引号、非标准 JSON）。
- **🚀 极致性能**：采用 O(1) 哈希索引算法，即使收录数万条语录也能毫秒级查重。
- **👆 戳一戳触发**：支持戳一戳机器人头像随机发送语录。
- **🎨 精美渲染**：使用 HTML/CSS 渲染高质量语录卡片，头像自动同步。

## 🛠️ 使用方法

### 基础指令

| 指令 | 别名 | 描述 |
| :--- | :--- | :--- |
| `/上传` | `/添加语录` | **(需回复某条消息)** 将该消息收录到语录库。 |
| `/语录` | `/抽卡`、`/随机语录` | 随机发送一张语录卡片。 |
| `/语录 @某人` | - | 随机发送该群友的一张语录。 |
| `/语录 5` | - | 随机发送 5 条语录（合成长图）。 |
| `/语录 @某人 5` | - | 随机发送该群友的 5 条语录。 |
| `/删除` | `/删除语录` | 删除机器人刚刚发送的那条语录（防社死）。 |
| `/一键金句` | `/智能收录` | **[AI]** 立即分析最近聊天记录并挖掘金句。 |

### 戳一戳
双击机器人头像（或群友头像，视配置而定），即可随机发送语录。

## ⚙️ 配置说明

- **无需前缀触发**：开启后，直接发“语录”即可触发，无需加 `/`。
- **全局库模式**：开启后所有群共享同一个语录库（默认是每个群独立的）。
- **戳一戳模式**：可选择“关闭”、“仅戳Bot”或“任意戳”（慎开启任意戳，可能刷屏）。
- **[AI] 指定模型ID**：建议指定一个 cheap 且 smart 的模型（如 `gpt-4o-mini` 或国产大模型），留空则使用当前对话模型。

## 📦 依赖

- **OneBot V11 协议端** (必须)：本插件依赖 OneBot API 获取历史消息 (`get_group_msg_history`) 和用户信息。
- 请确保你的 LLM 提供商支持较长的 Context Window（建议至少 16k），以便分析聊天记录。
